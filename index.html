<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 CIMA COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .active-tab { background-color: #2563eb !important; color: white !important; }
        input[type="range"] { accent-color: #2563eb; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [studyData, setStudyData] = useState([]);
            const [reviewData, setReviewData] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const savedStudy = localStorage.getItem('cima_v4_study');
                const savedReview = localStorage.getItem('cima_v4_review');

                if (savedStudy && savedReview) {
                    setStudyData(JSON.parse(savedStudy));
                    setReviewData(JSON.parse(savedReview));
                    setIsLoading(false);
                } else {
                    fetch('./data.json')
                        .then(res => res.json())
                        .then(data => {
                            setStudyData(data.studyData);
                            setReviewData(data.reviewData);
                            setIsLoading(false);
                        })
                        .catch(err => console.error("Error loading JSON:", err));
                }
            }, []);

            useEffect(() => {
                if (!isLoading) {
                    localStorage.setItem('cima_v4_study', JSON.stringify(studyData));
                    localStorage.setItem('cima_v4_review', JSON.stringify(reviewData));
                    if (window.lucide) window.lucide.createIcons();
                }
            }, [studyData, reviewData, activeTab, isLoading]);

            if (isLoading) return <div className="flex h-screen items-center justify-center font-bold">Loading...</div>;

            const handleStudyChange = (id, field, value) => {
                setStudyData(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };
            const handleReviewChange = (id, field, value) => {
                setReviewData(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };
            const calculateDays = (target) => {
                const diff = new Date(target) - new Date();
                return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
            };

            const totalGoal = studyData.reduce((acc, i) => acc + (Number(i.target) || 0), 0);
            const totalActual = studyData.reduce((acc, i) => acc + (Number(i.actual) || 0), 0);
            const progress = totalGoal > 0 ? Math.round((totalActual / totalGoal) * 100) : 0;

            return (
                <div className="min-h-screen pb-28">
                    <header className="bg-[#0f172a] text-white p-8">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-black tracking-tight uppercase">CIMA Command</h1>
                            </div>
                            <div className="flex bg-[#1e293b] p-1.5 rounded-2xl mt-6 md:mt-0">
                                {['dashboard', 'tracker', 'review'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)} className={`px-6 py-2 rounded-xl text-xs font-black uppercase transition-all ${activeTab === tab ? 'active-tab' : 'text-slate-400'}`}>
                                        {tab}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-8">
                        {activeTab === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                    <h3 className="text-slate-400 text-[10px] font-black uppercase mb-4">Progress</h3>
                                    <div className="text-5xl font-black">{progress}%</div>
                                    <div className="w-full bg-slate-100 rounded-full h-3 mt-4 overflow-hidden">
                                        <div className="bg-green-500 h-full" style={{width: `${progress}%`}}></div>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                    <h3 className="text-slate-400 text-[10px] font-black uppercase mb-4">Exam Countdown</h3>
                                    <div className="text-5xl font-black text-red-500">{calculateDays('2026-05-01')}</div>
                                </div>
                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                    <h3 className="text-slate-400 text-[10px] font-black uppercase mb-4">Vacation</h3>
                                    <div className="text-5xl font-black text-blue-600">{calculateDays('2026-01-09')}</div>
                                </div>
                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 font-black text-xs uppercase pt-10">
                                    <div className="flex justify-between"><span>Done</span> <span className="text-green-500">{studyData.filter(x=>x.status==='Done').length}</span></div>
                                    <div className="flex justify-between mt-2"><span>Pending</span> <span className="text-yellow-500">{studyData.filter(x=>x.status==='Pending').length}</span></div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'tracker' && (
                            <div className="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
                                <table className="w-full text-sm text-left">
                                    <thead className="bg-[#0f172a] text-white text-[10px] font-black uppercase">
                                        <tr><th className="px-6 py-5">Week</th><th className="px-6 py-5">Focus</th><th className="px-6 py-5 text-center">Actual</th><th className="px-6 py-5">Status</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 font-bold">
                                        {studyData.map(row => (
                                            <tr key={row.id}>
                                                <td className="px-6 py-5 text-slate-400">{row.weekStart}</td>
                                                <td className="px-6 py-5">{row.focus}</td>
                                                <td className="px-6 py-5 text-center">
                                                    <input type="number" value={row.actual} onChange={(e)=>handleStudyChange(row.id, 'actual', e.target.value)} className="w-16 bg-slate-50 border rounded-xl p-2 text-center" />
                                                </td>
                                                <td className="px-6 py-5 font-black uppercase text-[10px]">
                                                    <select value={row.status} onChange={(e)=>handleStudyChange(row.id, 'status', e.target.value)} className="bg-slate-100 p-2 rounded-xl border-none">
                                                        <option>Pending</option><option>Done</option><option>Planned Break</option><option>Missed</option>
                                                    </select>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {activeTab === 'review' && (
                            <div className="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden overflow-x-auto">
                                <table className="w-full text-sm text-left min-w-[1000px]">
                                    <thead className="bg-[#0f172a] text-white text-[10px] font-black uppercase">
                                        <tr><th className="px-6 py-5">Date</th><th className="px-6 py-5">Hours</th><th className="px-6 py-5 text-center">Gym</th><th className="px-6 py-5 text-center">Energy</th><th className="px-6 py-5">Well</th><th className="px-6 py-5">Obstacle</th><th className="px-6 py-5">Adjust</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 font-bold">
                                        {reviewData.map(row => (
                                            <tr key={row.id}>
                                                <td className="px-6 py-5 text-slate-400 whitespace-nowrap">{row.date}</td>
                                                <td className="px-6 py-5">
                                                    <select value={row.hoursHit} onChange={(e)=>handleReviewChange(row.id, 'hoursHit', e.target.value)} className="bg-slate-100 text-[10px] font-black p-2 rounded-lg">
                                                        <option>Pending</option><option>Yes</option><option>No</option><option>N/A</option>
                                                    </select>
                                                </td>
                                                <td className="px-6 py-5 text-center">
                                                    <input type="number" value={row.gymStreak} onChange={(e)=>handleReviewChange(row.id, 'gymStreak', e.target.value)} className="w-12 bg-slate-50 border rounded-lg p-1 text-center" />
                                                </td>
                                                <td className="px-6 py-5 text-center">
                                                    <input type="range" min="1" max="5" value={row.energy} onChange={(e)=>handleReviewChange(row.id, 'energy', e.target.value)} className="w-16 block mx-auto" />
                                                    <span className="text-[10px] text-blue-600">{row.energy}</span>
                                                </td>
                                                <td className="px-6 py-5"><input type="text" value={row.good} onChange={(e)=>handleReviewChange(row.id, 'good', e.target.value)} className="w-full bg-transparent outline-none text-slate-600" /></td>
                                                <td className="px-6 py-5"><input type="text" value={row.obstacle} onChange={(e)=>handleReviewChange(row.id, 'obstacle', e.target.value)} className="w-full bg-transparent outline-none text-slate-600" /></td>
                                                <td className="px-6 py-5"><input type="text" value={row.adjust} onChange={(e)=>handleReviewChange(row.id, 'adjust', e.target.value)} className="w-full bg-transparent outline-none text-slate-600" /></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </main>

                    <footer className="fixed bottom-0 w-full bg-white border-t p-4 flex justify-between items-center px-10 shadow-2xl z-50">
                        <div className="flex space-x-3">
                            <button onClick={() => {
                                const blob = new Blob([JSON.stringify({studyData, reviewData}, null, 2)], {type:'application/json'});
                                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'CIMA_Backup.json'; a.click();
                            }} className="bg-slate-900 text-white text-[10px] font-black uppercase px-5 py-2.5 rounded-2xl">Export</button>
                            
                            <button onClick={() => {
                                if(confirm("Clear local storage and reload from data.json?")) {
                                    localStorage.clear();
                                    window.location.reload();
                                }
                            }} className="bg-red-50 text-red-600 text-[10px] font-black uppercase px-5 py-2.5 rounded-2xl border border-red-100">Reset</button>

                            <button onClick={()=>fileInputRef.current.click()} className="bg-white border-2 border-slate-200 text-slate-900 text-[10px] font-black uppercase px-5 py-2.5 rounded-2xl">Import</button>
                            <input type="file" ref={fileInputRef} onChange={(e)=>{
                                const reader = new FileReader();
                                reader.onload = (ev)=>{
                                    const json = JSON.parse(ev.target.result);
                                    if(json.studyData) setStudyData(json.studyData);
                                    if(json.reviewData) setReviewData(json.reviewData);
                                };
                                reader.readAsText(e.target.files[0]);
                            }} className="hidden" />
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
