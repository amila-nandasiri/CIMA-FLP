<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 CIMA COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .active-tab { background-color: #2563eb !important; color: white !important; }
        .status-missed { background-color: #fee2e2; color: #991b1b; }
        .status-pending { background-color: #f1f5f9; color: #1e3a8a; }
        .status-done { background-color: #dcfce7; color: #166534; }
        .status-break { background-color: #dbeafe; color: #1e40af; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('tracker');
            const [studyData, setStudyData] = useState([]);
            const [reviewData, setReviewData] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const savedStudy = localStorage.getItem('cima_v6_study');
                const savedReview = localStorage.getItem('cima_v6_review');

                if (savedStudy && savedReview) {
                    setStudyData(JSON.parse(savedStudy));
                    setReviewData(JSON.parse(savedReview));
                    setIsLoading(false);
                } else {
                    fetch('./data.json')
                        .then(res => res.json())
                        .then(data => {
                            setStudyData(data.studyData);
                            setReviewData(data.reviewData);
                            setIsLoading(false);
                        });
                }
            }, []);

            useEffect(() => {
                if (!isLoading) {
                    localStorage.setItem('cima_v6_study', JSON.stringify(studyData));
                    localStorage.setItem('cima_v6_review', JSON.stringify(reviewData));
                    if (window.lucide) window.lucide.createIcons();
                }
            }, [studyData, reviewData, activeTab, isLoading]);

            if (isLoading) return <div className="flex h-screen items-center justify-center font-bold">Initializing Interface...</div>;

            // Metrics Logic
            const totalGoal = studyData.reduce((acc, i) => acc + (Number(i.target) || 0), 0);
            const totalActual = studyData.reduce((acc, i) => acc + (Number(i.actual) || 0), 0);
            const progress = totalGoal > 0 ? Math.round((totalActual / totalGoal) * 100) : 0;
            const daysToExam = Math.max(0, Math.ceil((new Date('2026-05-01') - new Date()) / (1000 * 60 * 60 * 24)));
            const daysToVacay = Math.max(0, Math.ceil((new Date('2026-01-09') - new Date()) / (1000 * 60 * 60 * 24)));

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-[#0f172a] text-white p-6 shadow-xl">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
                            <div className="mb-4 md:mb-0">
                                <h1 className="text-2xl font-black uppercase tracking-tight">2026 CIMA COMMAND CENTER</h1>
                                <p className="text-slate-400 text-xs font-medium">Operational Level & Life Planner</p>
                            </div>
                            <div className="flex bg-[#1e293b] p-1 rounded-xl space-x-1">
                                {['dashboard', 'tracker', 'review'].map(tab => (
                                    <button 
                                        key={tab} 
                                        onClick={() => setActiveTab(tab)} 
                                        className={`px-4 py-2 rounded-lg text-xs font-bold uppercase transition-all ${activeTab === tab ? 'active-tab' : 'text-slate-400 hover:text-white'}`}
                                    >
                                        {tab === 'tracker' ? 'Study Tracker' : tab === 'review' ? 'Weekly Review' : 'Dashboard'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-6">
                        {/* --- DASHBOARD TAB --- */}
                        {activeTab === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-slate-400 text-[10px] font-black uppercase tracking-widest">CIMA Progress</h3>
                                        <i data-lucide="activity" className="text-green-500 w-5 h-5"></i>
                                    </div>
                                    <div className="text-5xl font-black text-slate-900">{progress}%</div>
                                    <p className="text-slate-500 text-xs mt-2 font-bold">{totalActual} / {totalGoal} Hours</p>
                                    <div className="w-full bg-slate-100 rounded-full h-2 mt-4 overflow-hidden">
                                        <div className="bg-green-500 h-full" style={{width: `${progress}%`}}></div>
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-slate-400 text-[10px] font-black uppercase tracking-widest">Vacation</h3>
                                        <i data-lucide="plane" className="text-blue-500 w-5 h-5"></i>
                                    </div>
                                    <div className="text-5xl font-black text-slate-900">{daysToVacay}</div>
                                    <p className="text-slate-500 text-xs mt-2 font-bold uppercase">Days to go</p>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-slate-400 text-[10px] font-black uppercase tracking-widest">Exam Window</h3>
                                        <i data-lucide="book-open" className="text-red-500 w-5 h-5"></i>
                                    </div>
                                    <div className="text-5xl font-black text-slate-900">{daysToExam}</div>
                                    <p className="text-slate-500 text-xs mt-2 font-bold uppercase">Days to go</p>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-slate-400 text-[10px] font-black uppercase tracking-widest">Status</h3>
                                        <i data-lucide="bar-chart-3" className="text-purple-500 w-5 h-5"></i>
                                    </div>
                                    <div className="space-y-2 mt-2">
                                        <div className="flex justify-between text-xs font-black uppercase"><span className="text-green-600">Done</span> <span>{studyData.filter(x=>x.status==='Done').length}</span></div>
                                        <div className="flex justify-between text-xs font-black uppercase"><span className="text-yellow-500">Pending</span> <span>{studyData.filter(x=>x.status==='Pending').length}</span></div>
                                        <div className="flex justify-between text-xs font-black uppercase"><span className="text-blue-500">Break</span> <span>{studyData.filter(x=>x.status==='Planned Break').length}</span></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- TRACKER TAB --- */}
                        {activeTab === 'tracker' && (
                            <div className="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                                <table className="w-full text-sm text-left">
                                    <thead className="bg-[#0f172a] text-white uppercase text-[10px] font-black">
                                        <tr>
                                            <th className="px-6 py-5">Week Starting</th>
                                            <th className="px-6 py-5">Phase</th>
                                            <th className="px-6 py-5">Focus Area</th>
                                            <th className="px-6 py-5 text-center">Target</th>
                                            <th className="px-6 py-5 text-center">Actual</th>
                                            <th className="px-6 py-5">Status</th>
                                            <th className="px-6 py-5">Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 font-bold">
                                        {studyData.map(row => (
                                            <tr key={row.id}>
                                                <td className="px-6 py-4 text-slate-500 whitespace-nowrap">{row.weekStart}</td>
                                                <td className="px-6 py-4 text-slate-400 text-[11px]">{row.phase}</td>
                                                <td className="px-6 py-4 text-slate-900">{row.focus}</td>
                                                <td className="px-6 py-4 text-center text-slate-400">{row.target}</td>
                                                <td className="px-6 py-4 text-center">
                                                    <input type="number" value={row.actual} onChange={(e) => setStudyData(prev => prev.map(i => i.id === row.id ? {...i, actual: e.target.value} : i))} className="w-16 bg-slate-50 border rounded-xl p-2 text-center" />
                                                </td>
                                                <td className="px-6 py-4">
                                                    <select value={row.status} onChange={(e) => setStudyData(prev => prev.map(i => i.id === row.id ? {...i, status: e.target.value} : i))} className={`text-[10px] font-black p-2.5 rounded-xl border-none outline-none ${row.status === 'Done' ? 'status-done' : row.status === 'Planned Break' ? 'status-break' : row.status === 'Missed' ? 'status-missed' : 'status-pending'}`}>
                                                        <option value="Pending">Pending</option>
                                                        <option value="Done">Done</option>
                                                        <option value="Planned Break">Planned Break</option>
                                                        <option value="Missed">Missed</option>
                                                    </select>
                                                </td>
                                                <td className="px-6 py-4 text-slate-400 text-xs">{row.notes}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {/* --- REVIEW TAB --- */}
                        {activeTab === 'review' && (
                            <div className="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden overflow-x-auto">
                                <table className="w-full text-sm text-left min-w-[1000px]">
                                    <thead className="bg-[#0f172a] text-white uppercase text-[10px] font-black">
                                        <tr>
                                            <th className="px-6 py-5">Date</th>
                                            <th className="px-6 py-5">Phase</th>
                                            <th className="px-6 py-5">Hours Hit?</th>
                                            <th className="px-6 py-5 text-center">Gym</th>
                                            <th className="px-6 py-5 text-center">Energy</th>
                                            <th className="px-6 py-5">What Went Well?</th>
                                            <th className="px-6 py-5">Obstacles</th>
                                            <th className="px-6 py-5">Adjustments</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 font-bold text-slate-900">
                                        {reviewData.map(row => (
                                            <tr key={row.id}>
                                                <td className="px-6 py-5 text-slate-400 whitespace-nowrap">{row.date}</td>
                                                <td className="px-6 py-5 text-slate-400 text-[10px]">{row.phase}</td>
                                                <td className="px-6 py-5">
                                                    <select value={row.hoursHit} onChange={(e) => setReviewData(prev => prev.map(i => i.id === row.id ? {...i, hoursHit: e.target.value} : i))} className="bg-slate-100 text-[10px] font-black p-2 rounded-lg">
                                                        <option>Pending</option><option>Yes</option><option>No</option><option>N/A</option>
                                                    </select>
                                                </td>
                                                <td className="px-6 py-5 text-center">
                                                    <input type="number" value={row.gymStreak} onChange={(e) => setReviewData(prev => prev.map(i => i.id === row.id ? {...i, gymStreak: e.target.value} : i))} className="w-12 border rounded-lg p-1 text-center" />
                                                </td>
                                                <td className="px-6 py-5 text-center">
                                                    <input type="range" min="1" max="5" value={row.energy} onChange={(e) => setReviewData(prev => prev.map(i => i.id === row.id ? {...i, energy: e.target.value} : i))} className="w-16" />
                                                    <div className="text-[10px] font-black text-blue-600">{row.energy}</div>
                                                </td>
                                                <td className="px-6 py-5"><input type="text" value={row.good} onChange={(e) => setReviewData(prev => prev.map(i => i.id === row.id ? {...i, good: e.target.value} : i))} className="w-full bg-transparent outline-none" placeholder="..." /></td>
                                                <td className="px-6 py-5"><input type="text" value={row.obstacle} onChange={(e) => setReviewData(prev => prev.map(i => i.id === row.id ? {...i, obstacle: e.target.value} : i))} className="w-full bg-transparent outline-none" placeholder="..." /></td>
                                                <td className="px-6 py-5"><input type="text" value={row.adjust} onChange={(e) => setReviewData(prev => prev.map(i => i.id === row.id ? {...i, adjust: e.target.value} : i))} className="w-full bg-transparent outline-none" placeholder="..." /></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </main>

                    <footer className="fixed bottom-0 w-full bg-white border-t p-4 flex justify-between items-center px-10 shadow-2xl z-50">
                        <div className="flex space-x-3">
                            <button onClick={() => {
                                const blob = new Blob([JSON.stringify({studyData, reviewData}, null, 2)], {type:'application/json'});
                                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'CIMA_Backup.json'; a.click();
                            }} className="bg-slate-900 text-white text-[10px] font-black uppercase px-5 py-2.5 rounded-2xl">Export</button>
                            
                            <button onClick={() => {
                                if(confirm("This will overwrite your browser data with the original data.json file. Continue?")) {
                                    localStorage.clear();
                                    window.location.reload();
                                }
                            }} className="bg-red-50 text-red-600 text-[10px] font-black uppercase px-5 py-2.5 rounded-2xl border border-red-100">Master Reset</button>
                        </div>
                        <span className="text-[10px] font-black text-slate-300 uppercase tracking-widest hidden md:block">Browser Auto-Save Active</span>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
